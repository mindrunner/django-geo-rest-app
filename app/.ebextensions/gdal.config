commands:
  01_execute_script:
    test: test ! -e /usr/bin/gdalinfo
    command:        "/tmp/gdal_install.sh"

files:
  "/tmp/gdal_install.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/usr/bin/env bash
      # Geos
      cd ~
      wget -O ~/geos-3.7.2.tar.bz2 http://download.osgeo.org/geos/geos-3.7.2.tar.bz2
      tar xjf ~/geos-3.7.2.tar.bz2
      cd ~/geos-3.7.2
      ./configure --prefix=/usr --enable-python
      make
      sudo make install

      # Proj4
      cd ~
      wget -O ~/proj-6.1.0.tar.gz http://download.osgeo.org/proj/proj-6.1.0.tar.gz
      wget -O ~/proj-datumgrid-1.7.tar.gz http://download.osgeo.org/proj/proj-datumgrid-1.7.tar.gz
      tar xzf ~/proj-6.1.0.tar.gz
      cd ~/proj-6.1.0/data
      tar xzf ~/proj-datumgrid-1.7.tar.gz
      cd ..
      ./configure --prefix=/usr
      make
      sudo make install

      # GDAL
      cd ~
      wget -O ~/gdal-2.3.2.tar.gz http://download.osgeo.org/gdal/2.3.2/gdal-2.3.2.tar.gz
      tar xzf ~/gdal-2.3.2.tar.gz
      cd ~/gdal-2.3.2
      ./configure --prefix=/usr --with-python --with-pg --with-geos --with-curl
      make
      sudo make install

      sudo ldconfig